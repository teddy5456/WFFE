<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Admin | WFFE Connect</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .logo i {
            font-size: 24px;
        }
        
        .sidebar-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 15px 0;
        }
        
        .nav-section {
            margin-bottom: 20px;
        }
        
        .nav-title {
            padding: 10px 20px;
            font-size: 12px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
        }
        
        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-nav li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.2s;
            position: relative;
        }
        
        .sidebar-nav li a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .sidebar-nav li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .sidebar-nav li.active a {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 3px solid #3498db;
        }
        
        .badge {
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            margin-left: auto;
        }
        
        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-info {
            flex: 1;
        }
        
        .name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .role {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }
        
        .user-menu {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .topbar {
            background: white;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .topbar-left h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            margin: 0 5px;
            color: #bdc3c7;
        }
        
        .breadcrumb .active {
            color: #7f8c8d;
        }
        
        .topbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .quick-action-btn:hover {
            background: #2980b9;
        }
        
        .quick-action-btn.secondary {
            background: #f5f7fa;
            color: #2c3e50;
        }
        
        .quick-action-btn.secondary:hover {
            background: #e0e7ee;
        }
        
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f5f7fa;
        }
        
        /* Admin-Specific Product Styles */
        .admin-tools {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .admin-actions {
            display: flex;
            gap: 15px;
        }
        
        .search-box {
            position: relative;
            min-width: 300px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .filter-select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: #fff;
            min-width: 180px;
        }
        
        /* Inventory Management Section */
        .inventory-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 18px;
            color: #2c3e50;
        }
        
        .inventory-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: #f5f7fa;
            border-radius: 6px;
            padding: 15px;
            min-width: 150px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            color: #7f8c8d;
        }
        
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .inventory-table th, 
        .inventory-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .inventory-table th {
            font-weight: 600;
            color: #2c3e50;
            background: #f9f9f9;
            position: sticky;
            top: 0;
        }
        
        .inventory-table tr:hover {
            background: #f5f5f5;
        }
        
        .product-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .product-cell img {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .product-info {
            display: flex;
            flex-direction: column;
        }
        
        .product-name {
            font-weight: 500;
        }
        
        .product-sku {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .stock-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .in-stock {
            background: #e3f7e8;
            color: #28a745;
        }
        
        .low-stock {
            background: #fff3cd;
            color: #856404;
        }
        
        .out-of-stock {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.active {
            background: #e3f7e8;
            color: #28a745;
        }
        
        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .action-btn.inventory {
            background: #3498db;
            color: white;
        }
        
        .action-btn.inventory:hover {
            background: #2980b9;
        }
        
        .action-btn.edit {
            background: #f5f5f5;
            color: #2c3e50;
        }
        
        .action-btn.edit:hover {
            background: #e0e0e0;
        }
        
        /* Bulk Actions */
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .bulk-select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
        }
        
        .bulk-apply {
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .bulk-apply:hover {
            background: #2980b9;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #888;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .form-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
        }
        
        .tab-btn.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-hint {
            display: block;
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-primary {
            background: #3498db;
            border: 1px solid #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            border-color: #2980b9;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Image Upload Styles */
        .image-upload-box {
            border: 2px dashed #ddd;
            border-radius: 6px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload-box:hover {
            border-color: #3498db;
            background: #f8fafc;
        }

        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .upload-label i {
            font-size: 32px;
            color: #3498db;
        }

        .image-preview-grid, .existing-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .image-preview-item, .existing-image-item {
            position: relative;
            border: 1px solid #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .image-preview-item img, .existing-image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            padding: 5px;
        }

        .image-actions button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px 10px;
        }

        .image-actions button:hover {
            color: #3498db;
        }

        .primary-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #3498db;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
        }
        
        /* Form Validation */
        .tab-content:not(.active) input,
        .tab-content:not(.active) select,
        .tab-content:not(.active) textarea {
            display: none !important;
        }
        
        .image-error {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .uploading-spinner {
            display: none;
            margin-top: 10px;
        }
        
        .uploading-spinner.active {
            display: block;
        }
        
        .field-error {
            border-color: #e74c3c !important;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .admin-tools {
                flex-direction: column;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
            
            .image-preview-grid, .existing-images-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-couch"></i>
                    <span>WFFE Connect</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-title">Admin</div>
                    <ul>
                        <li>
                            <a href="/admin/dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="active">
                            <a href="#">
                                <i class="fas fa-cubes"></i>
                                <span>Products</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-tags"></i>
                                <span>Categories</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-users"></i>
                                <span>Customers</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-file-invoice-dollar"></i>
                                <span>Orders</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">System</div>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fas fa-sliders-h"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-users-cog"></i>
                                <span>Admin Users</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-chart-line"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-tools"></i>
                                <span>Tools</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="avatar">
                        <img src="https://randomuser.me/api/portraits/women/45.jpg" alt="User">
                    </div>
                    <div class="user-info">
                        <div class="name">Admin User</div>
                        <div class="role">Super Admin</div>
                    </div>
                    <button class="user-menu">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <div class="topbar-left">
                    <h1>Product Management</h1>
                    <div class="breadcrumb">
                        <a href="#">Admin</a>
                        <span>/</span>
                        <a href="#" class="active">Products</a>
                    </div>
                </div>
                <div class="topbar-right">
                    <button class="quick-action-btn" id="add-product">
                        <i class="fas fa-plus"></i>
                        <span>Add Product</span>
                    </button>
                    <button class="quick-action-btn secondary" id="export-products">
                        <i class="fas fa-file-export"></i>
                        <span>Export</span>
                    </button>
                </div>
            </header>

            <div class="content-wrapper">
                <!-- Admin Tools -->
                <div class="admin-tools">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search products by name, SKU or description..." id="product-search">
                    </div>
                    
                    <div class="admin-actions">
                        <select class="filter-select" id="category-filter">
                            <option value="">All Categories</option>
                            <option value="1">Living Room</option>
                            <option value="2">Bedroom</option>
                            <option value="3">Dining Room</option>
                            <option value="4">Office</option>
                        </select>
                        <select class="filter-select" id="status-filter">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="out-of-stock">Out of Stock</option>
                            <option value="low-stock">Low Stock</option>
                        </select>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading products...</p>
                </div>

                <!-- Inventory Management Section -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h2>Inventory Management</h2>
                        <div class="section-actions">
                            <button class="action-btn edit" id="bulk-edit">
                                <i class="fas fa-edit"></i>
                                Bulk Edit
                            </button>
                        </div>
                    </div>
                    
                    <div class="inventory-stats" id="inventory-stats">
                        <div class="stat-card">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">0</div>
                            <div class="stat-label">In Stock</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Low Stock</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Out of Stock</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Active</div>
                        </div>
                    </div>
                    
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th width="30"><input type="checkbox" id="select-all"></th>
                                <th>Product</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">
                                    No products found
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="bulk-actions">
                        <select class="bulk-select" id="bulk-action">
                            <option value="">Bulk Actions</option>
                            <option value="activate">Activate</option>
                            <option value="deactivate">Deactivate</option>
                            <option value="adjust-stock">Adjust Stock</option>
                            <option value="update-category">Update Category</option>
                            <option value="export-selected">Export Selected</option>
                        </select>
                        <button class="bulk-apply" id="apply-bulk-action">Apply</button>
                    </div>
                </div>
                
                <!-- Low Stock Alert Section -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h2>Low Stock Alerts</h2>
                        <div class="section-actions">
                            <button class="action-btn edit" id="export-low-stock">
                                <i class="fas fa-file-export"></i>
                                Export List
                            </button>
                        </div>
                    </div>
                    
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>SKU</th>
                                <th>Current Stock</th>
                                <th>Threshold</th>
                                <th>Last Ordered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="low-stock-table-body">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 20px;">
                                    No low stock products at this time
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Recently Updated Products -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h2>Recently Updated Products</h2>
                        <div class="section-actions">
                            <select class="filter-select" id="recent-filter">
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                            </select>
                        </div>
                    </div>
                    
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Updated</th>
                                <th>Changes</th>
                                <th>Updated By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-products-table-body">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">
                                    No recently updated products
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modal-title">Add New Product</h2>
            <form id="product-form" novalidate>
                <input type="hidden" id="product-id">
                
                <div class="form-tabs">
                    <button type="button" class="tab-btn active" data-tab="basic-info">Basic Info</button>
                    <button type="button" class="tab-btn" data-tab="pricing">Pricing</button>
                    <button type="button" class="tab-btn" data-tab="inventory">Inventory</button>
                    <button type="button" class="tab-btn" data-tab="images">Images</button>
                    <button type="button" class="tab-btn" data-tab="seo">SEO</button>
                </div>
                
                <!-- Basic Info Tab -->
                <div class="tab-content active" id="basic-info-tab">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">Product Name *</label>
                            <input type="text" id="product-name" placeholder="e.g., Premium Lounge Chair" required>
                            <div class="error-message" id="name-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="product-sku">SKU *</label>
                            <input type="text" id="product-sku" placeholder="e.g., WFFE-CH-001" required>
                            <small class="form-hint">Unique product identifier</small>
                            <div class="error-message" id="sku-error"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-subtitle">Subtitle</label>
                            <input type="text" id="product-subtitle" placeholder="Short product subtitle">
                        </div>
                        <div class="form-group">
                            <label for="product-slug">URL Slug</label>
                            <input type="text" id="product-slug" placeholder="premium-lounge-chair">
                            <small class="form-hint">Leave blank to auto-generate</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">Category *</label>
                            <select id="product-category" required>
                                <option value="">Select Category</option>
                                <option value="1">Living Room</option>
                                <option value="2">Bedroom</option>
                                <option value="3">Dining Room</option>
                                <option value="4">Office</option>
                            </select>
                            <div class="error-message" id="category-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="product-subcategory">Subcategory</label>
                            <select id="product-subcategory">
                                <option value="">Select Subcategory</option>
                                <option value="1">Sofas</option>
                                <option value="2">Chairs</option>
                                <option value="3">Tables</option>
                                <option value="4">Beds</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="short-description">Short Description *</label>
                        <textarea id="short-description" rows="3" placeholder="Brief description shown in product listings" required></textarea>
                        <div class="error-message" id="short-desc-error"></div>
                    </div>

                    <div class="form-group">
                        <label for="product-description">Full Description</label>
                        <textarea id="product-description" rows="5" placeholder="Detailed product description with features, materials, etc."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="is-featured">
                                Featured Product
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="is-bestseller">
                                Bestseller
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="is-new" checked>
                                New Arrival
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="is-customizable" checked>
                                Customizable
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Pricing Tab -->
                <div class="tab-content" id="pricing-tab">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-price">Price ($) *</label>
                            <input type="number" id="product-price" step="0.01" min="0" placeholder="0.00" required>
                            <div class="error-message" id="price-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="original-price">Original Price ($)</label>
                            <input type="number" id="original-price" step="0.01" min="0" placeholder="0.00">
                            <small class="form-hint">Shown crossed out for discounts</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-cost">Cost per item ($)</label>
                        <input type="number" id="product-cost" step="0.01" min="0" placeholder="0.00">
                        <small class="form-hint">Used to calculate profit margins</small>
                    </div>
                </div>
                
                <!-- Inventory Tab -->
                <div class="tab-content" id="inventory-tab">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stock-quantity">Stock Quantity *</label>
                            <input type="number" id="stock-quantity" min="0" value="0" required>
                            <div class="error-message" id="stock-error"></div>
                        </div>
                        <div class="form-group">
                            <label for="low-stock-threshold">Low Stock Threshold</label>
                            <input type="number" id="low-stock-threshold" min="1" value="3">
                            <small class="form-hint">When to show "Low Stock" warning</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="is-active" checked>
                            Product is active
                        </label>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="weight-kg">Weight (kg)</label>
                            <input type="number" id="weight-kg" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="dimensions">Dimensions (cm)</label>
                            <input type="text" id="dimensions" placeholder="L x W x H">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="warranty-period">Warranty Period</label>
                        <input type="text" id="warranty-period" placeholder="e.g., 2 years">
                    </div>
                </div>
                
                <!-- Images Tab -->
                <div class="tab-content" id="images-tab">
                    <div class="form-group">
                        <label>Product Images</label>
                        <div id="image-upload-container">
                            <div class="image-upload-box">
                                <input type="file" id="product-images" accept="image/*" multiple style="display: none;">
                                <label for="product-images" class="upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Click to upload images or drag and drop</span>
                                    <small class="form-hint">Recommended size: 800x800px, max 5MB per image</small>
                                </label>
                            </div>
                        </div>
                        
                        <div id="image-preview-container" style="margin-top: 20px; display: none;">
                            <h4>Uploaded Images</h4>
                            <div class="image-preview-grid" id="image-preview-grid">
                                <!-- Preview images will be added here -->
                            </div>
                        </div>
                        
                        <div id="existing-images-container" style="margin-top: 20px;">
                            <h4>Existing Images</h4>
                            <div class="existing-images-grid" id="existing-images-grid">
                                <!-- Existing images will be shown here when editing -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- SEO Tab -->
                <div class="tab-content" id="seo-tab">
                    <div class="form-group">
                        <label for="meta-title">Meta Title</label>
                        <input type="text" id="meta-title" placeholder="Optimal length 50-60 characters">
                        <small class="form-hint">Title for search engines</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="meta-description">Meta Description</label>
                        <textarea id="meta-description" rows="3" placeholder="Optimal length 150-160 characters"></textarea>
                        <small class="form-hint">Description for search engines</small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-product">Cancel</button>
                    <button type="button" class="btn btn-secondary" id="save-draft">Save Draft</button>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div class="modal" id="bulk-edit-modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Bulk Edit Products</h2>
            <form id="bulk-edit-form">
                <div class="form-group">
                    <label for="bulk-edit-field">Field to Edit</label>
                    <select id="bulk-edit-field" class="form-control">
                        <option value="">Select Field</option>
                        <option value="price">Price</option>
                        <option value="cost">Cost</option>
                        <option value="category">Category</option>
                        <option value="subcategory">Subcategory</option>
                        <option value="stock">Stock Quantity</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                
                <div class="form-group" id="bulk-edit-value-container" style="display: none;">
                    <label id="bulk-edit-value-label">Value</label>
                    <div id="bulk-edit-value-input"></div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-bulk-edit">Cancel</button>
                    <button type="submit" class="btn btn-primary">Apply Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8000';
        const PRODUCTS_ENDPOINT = `${API_BASE_URL}/api/products`;
        const CATEGORIES_ENDPOINT = `${API_BASE_URL}/api/categories`;
        const SUBCATEGORIES_ENDPOINT = `${API_BASE_URL}/api/subcategories`;
        const PRODUCT_IMAGES_ENDPOINT = `${API_BASE_URL}/api/product-images`;
        
        // DOM Elements
        const inventoryTableBody = document.getElementById('inventory-table-body');
        const lowStockTableBody = document.getElementById('low-stock-table-body');
        const recentProductsTableBody = document.getElementById('recent-products-table-body');
        const inventoryStats = document.getElementById('inventory-stats');
        const loadingSpinner = document.getElementById('loading-spinner');
        const categoryFilter = document.getElementById('category-filter');
        const statusFilter = document.getElementById('status-filter');
        const recentFilter = document.getElementById('recent-filter');
        const productSearch = document.getElementById('product-search');
        const productCategory = document.getElementById('product-category');
        const productSubcategory = document.getElementById('product-subcategory');
        const productModal = document.getElementById('product-modal');
        const bulkEditModal = document.getElementById('bulk-edit-modal');
        const modalTitle = document.getElementById('modal-title');
        const productForm = document.getElementById('product-form');
        const addProductBtn = document.getElementById('add-product');
        const exportProductsBtn = document.getElementById('export-products');
        const bulkEditBtn = document.getElementById('bulk-edit');
        const exportLowStockBtn = document.getElementById('export-low-stock');
        const cancelProductBtn = document.getElementById('cancel-product');
        const saveDraftBtn = document.getElementById('save-draft');
        const cancelBulkEditBtn = document.getElementById('cancel-bulk-edit');
        const selectAllCheckbox = document.getElementById('select-all');
        const applyBulkActionBtn = document.getElementById('apply-bulk-action');
        
        // Image Upload Elements
        const imageUploadContainer = document.getElementById('image-upload-container');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreviewGrid = document.getElementById('image-preview-grid');
        const existingImagesGrid = document.getElementById('existing-images-grid');
        const productImagesInput = document.getElementById('product-images');
        
        // Global Variables
        let products = [];
        let categories = [];
        let subcategories = [];
        let selectedProductImages = [];
        let deletedImageIds = [];
        let existingImages = [];
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadProducts();
            setupEventListeners();
            setupImageUpload();
        });
        
        // Fetch all products from the API
        async function loadProducts() {
            try {
                showLoading();
                const response = await fetch(PRODUCTS_ENDPOINT);
                if (!response.ok) {
                    throw new Error('Failed to fetch products');
                }
                products = await response.json();
                renderInventoryTable();
                updateInventoryStats();
                renderLowStockTable();
                renderRecentProductsTable();
                hideLoading();
            } catch (error) {
                console.error('Error loading products:', error);
                hideLoading();
                alert('Error loading products. Please try again.');
            }
        }
        
        // Fetch categories from the API
        async function loadCategories() {
            try {
                const response = await fetch(CATEGORIES_ENDPOINT);
                if (!response.ok) {
                    throw new Error('Failed to fetch categories');
                }
                categories = await response.json();
                populateCategoryDropdowns();
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Populate category dropdowns
        function populateCategoryDropdowns() {
            // Main category filter
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.category_id;
                option.textContent = category.name;
                categoryFilter.appendChild(option);
            });
            
            // Product form category dropdown
            productCategory.innerHTML = '<option value="">Select Category</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.category_id;
                option.textContent = category.name;
                productCategory.appendChild(option);
            });
        }
        
        // Render inventory table
        function renderInventoryTable() {
            inventoryTableBody.innerHTML = '';
            
            if (products.length === 0) {
                inventoryTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            No products found
                        </td>
                    </tr>
                `;
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.setAttribute('data-product-id', product.product_id);
                
                // Find category name
                const category = categories.find(c => c.category_id === product.category_id);
                const categoryName = category ? category.name : 'N/A';
                
                // Determine stock status
                let stockStatus = '';
                let stockClass = '';
                if (product.stock_quantity <= 0) {
                    stockStatus = 'Out of Stock';
                    stockClass = 'out-of-stock';
                } else if (product.stock_quantity <= product.low_stock_threshold) {
                    stockStatus = `${product.stock_quantity}`;
                    stockClass = 'low-stock';
                } else {
                    stockStatus = `${product.stock_quantity}`;
                    stockClass = 'in-stock';
                }
                
                // Get primary image or default
                const primaryImage = product.images?.find(img => img.is_primary) || product.images?.[0];
                const imageUrl = primaryImage?.image_url || 'https://via.placeholder.com/40';
                
                row.innerHTML = `
                    <td><input type="checkbox" class="product-checkbox" value="${product.product_id}"></td>
                    <td>
                        <div class="product-cell">
                            <img src="${imageUrl}" alt="${product.name}">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <div class="product-sku">SKU: ${product.sku}</div>
                            </div>
                        </div>
                    </td>
                    <td>${product.sku}</td>
                    <td>${categoryName}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>
                        <span class="stock-badge ${stockClass}">${stockStatus}</span>
                    </td>
                    <td>
                        <span class="status-badge ${product.is_active ? 'active' : 'inactive'}">${product.is_active ? 'Active' : 'Inactive'}</span>
                    </td>
                    <td>
                        <button class="action-btn inventory" data-product-id="${product.product_id}"><i class="fas fa-boxes"></i> Manage</button>
                        <button class="action-btn edit" data-product-id="${product.product_id}"><i class="fas fa-edit"></i></button>
                    </td>
                `;
                
                inventoryTableBody.appendChild(row);
            });
        }
        
        // Update inventory statistics
        function updateInventoryStats() {
            const totalProducts = products.length;
            const inStock = products.filter(p => p.stock_quantity > 0).length;
            const lowStock = products.filter(p => p.stock_quantity > 0 && p.stock_quantity <= p.low_stock_threshold).length;
            const outOfStock = products.filter(p => p.stock_quantity <= 0).length;
            const activeProducts = products.filter(p => p.is_active).length;
            
            document.querySelectorAll('.stat-value').forEach((el, index) => {
                switch(index) {
                    case 0: el.textContent = totalProducts; break;
                    case 1: el.textContent = inStock; break;
                    case 2: el.textContent = lowStock; break;
                    case 3: el.textContent = outOfStock; break;
                    case 4: el.textContent = activeProducts; break;
                }
            });
        }
        
        // Render low stock table
        function renderLowStockTable() {
            lowStockTableBody.innerHTML = '';
            
            const lowStockProducts = products.filter(p => 
                p.stock_quantity > 0 && p.stock_quantity <= p.low_stock_threshold
            );
            
            if (lowStockProducts.length === 0) {
                lowStockTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            No low stock products at this time
                        </td>
                    </tr>
                `;
                return;
            }
            
            lowStockProducts.forEach(product => {
                const row = document.createElement('tr');
                
                // Get primary image or default
                const primaryImage = product.images?.find(img => img.is_primary) || product.images?.[0];
                const imageUrl = primaryImage?.image_url || 'https://via.placeholder.com/40';
                
                row.innerHTML = `
                    <td>
                        <div class="product-cell">
                            <img src="${imageUrl}" alt="${product.name}">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <div class="product-sku">SKU: ${product.sku}</div>
                            </div>
                        </div>
                    </td>
                    <td>${product.sku}</td>
                    <td>${product.stock_quantity}</td>
                    <td>${product.low_stock_threshold}</td>
                    <td>${new Date().toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn inventory" data-product-id="${product.product_id}"><i class="fas fa-boxes"></i> Restock</button>
                    </td>
                `;
                
                lowStockTableBody.appendChild(row);
            });
        }
        
        // Render recently updated products table
        function renderRecentProductsTable() {
            recentProductsTableBody.innerHTML = '';
            
            // Sort products by updated_at (newest first)
            const recentProducts = [...products].sort((a, b) => 
                new Date(b.updated_at) - new Date(a.updated_at)
            ).slice(0, 5);
            
            if (recentProducts.length === 0) {
                recentProductsTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            No recently updated products
                        </td>
                    </tr>
                `;
                return;
            }
            
            recentProducts.forEach(product => {
                const row = document.createElement('tr');
                
                // Get primary image or default
                const primaryImage = product.images?.find(img => img.is_primary) || product.images?.[0];
                const imageUrl = primaryImage?.image_url || 'https://via.placeholder.com/40';
                
                row.innerHTML = `
                    <td>
                        <div class="product-cell">
                            <img src="${imageUrl}" alt="${product.name}">
                            <div class="product-name">${product.name}</div>
                        </div>
                    </td>
                    <td>${new Date(product.updated_at).toLocaleString()}</td>
                    <td>Price, Stock</td>
                    <td>Admin User</td>
                    <td>
                        <button class="action-btn edit" data-product-id="${product.product_id}"><i class="fas fa-edit"></i> Edit</button>
                    </td>
                `;
                
                recentProductsTableBody.appendChild(row);
            });
        }
        
        // Setup image upload functionality
        function setupImageUpload() {
            const imageUploadBox = document.querySelector('.image-upload-box');
            
            // Handle file selection
            productImagesInput.addEventListener('change', function(e) {
                const files = e.target.files;
                if (!files || files.length === 0) return;
                
                // Clear previous errors and previews
                document.querySelectorAll('.image-error').forEach(el => el.remove());
                imagePreviewContainer.style.display = 'block';
                imagePreviewGrid.innerHTML = '';
                selectedProductImages = [];
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // Validate file
                    if (!file.type.match('image.*')) {
                        showImageError(file, 'Invalid file type (images only)');
                        continue;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        showImageError(file, 'File too large (max 5MB)');
                        continue;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const tempId = 'img-' + Math.random().toString(36).substr(2, 9);
                        const previewItem = document.createElement('div');
                        previewItem.className = 'image-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <div class="image-actions">
                                <button type="button" class="set-primary" data-temp-id="${tempId}">
                                    <i class="fas fa-star"></i> Primary
                                </button>
                                <button type="button" class="remove-image" data-temp-id="${tempId}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        imagePreviewGrid.appendChild(previewItem);
                        
                        selectedProductImages.push({
                            file: file,
                            preview: e.target.result,
                            isPrimary: selectedProductImages.length === 0, // First image is primary by default
                            tempId: tempId
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle drag and drop
            imageUploadBox.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#3498db';
                this.style.backgroundColor = '#f8fafc';
            });
            
            imageUploadBox.addEventListener('dragleave', function() {
                this.style.borderColor = '#ddd';
                this.style.backgroundColor = '';
            });
            
            imageUploadBox.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#ddd';
                this.style.backgroundColor = '';
                
                productImagesInput.files = e.dataTransfer.files;
                productImagesInput.dispatchEvent(new Event('change'));
            });
            
            // Handle image actions in preview
            imagePreviewContainer.addEventListener('click', function(e) {
                if (e.target.closest('.set-primary')) {
                    const tempId = e.target.closest('.set-primary').getAttribute('data-temp-id');
                    
                    // Update all images to not primary
                    selectedProductImages.forEach(img => img.isPrimary = false);
                    
                    // Find and set the selected image as primary
                    const selectedIndex = selectedProductImages.findIndex(img => img.tempId === tempId);
                    if (selectedIndex !== -1) {
                        selectedProductImages[selectedIndex].isPrimary = true;
                    }
                    
                    // Update UI
                    document.querySelectorAll('.image-preview-item .set-primary').forEach(btn => {
                        btn.innerHTML = '<i class="fas fa-star"></i> Primary';
                    });
                    e.target.closest('.set-primary').innerHTML = '<i class="fas fa-check"></i> Primary';
                }
                
                if (e.target.closest('.remove-image')) {
                    const tempId = e.target.closest('.remove-image').getAttribute('data-temp-id');
                    
                    // Remove from selected images array
                    selectedProductImages = selectedProductImages.filter(img => img.tempId !== tempId);
                    
                    // Remove from preview
                    e.target.closest('.image-preview-item').remove();
                    
                    // If no images left, hide the preview container
                    if (imagePreviewGrid.children.length === 0) {
                        imagePreviewContainer.style.display = 'none';
                    }
                }
            });
            
            // Handle existing image actions
            existingImagesGrid.addEventListener('click', function(e) {
                const productId = document.getElementById('product-id').value;
                
                if (e.target.closest('.set-primary-existing')) {
                    const imageId = e.target.closest('.set-primary-existing').getAttribute('data-image-id');
                    setPrimaryImage(productId, imageId);
                }
                
                if (e.target.closest('.delete-image')) {
                    const imageId = e.target.closest('.delete-image').getAttribute('data-image-id');
                    deleteImage(productId, imageId);
                }
            });
        }
        
        // Show image error message
        function showImageError(file, message) {
            const errorEl = document.createElement('div');
            errorEl.className = 'image-error';
            errorEl.textContent = `${file.name}: ${message}`;
            imageUploadContainer.appendChild(errorEl);
        }
        
        // Render existing images when editing a product
        function renderExistingImages(images) {
            existingImagesGrid.innerHTML = '';
            existingImages = images || [];
            
            if (!existingImages || existingImages.length === 0) {
                existingImagesGrid.innerHTML = '<p>No images uploaded yet.</p>';
                return;
            }
            
            existingImages.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'existing-image-item';
                imageItem.innerHTML = `
                    <img src="${image.image_url}" alt="${image.alt_text || 'Product image'}">
                    ${image.is_primary ? '<span class="primary-badge">Primary</span>' : ''}
                    <div class="image-actions">
                        <button type="button" class="set-primary-existing" data-image-id="${image.image_id}">
                            <i class="fas fa-star"></i> Set Primary
                        </button>
                        <button type="button" class="delete-image" data-image-id="${image.image_id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                existingImagesGrid.appendChild(imageItem);
            });
        }
        
        // Set an image as primary via API
        async function setPrimaryImage(productId, imageId) {
            try {
                const response = await fetch(`${PRODUCT_IMAGES_ENDPOINT}/${imageId}/primary`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_id: productId
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to set primary image');
                }
                
                // Reload the product to update the UI
                await loadProductForEditing(productId);
            } catch (error) {
                console.error('Error setting primary image:', error);
                alert('Error setting primary image. Please try again.');
            }
        }
        
        // Delete an image via API
        async function deleteImage(productId, imageId) {
            if (!confirm('Are you sure you want to delete this image?')) {
                return;
            }
            
            try {
                const response = await fetch(`${PRODUCT_IMAGES_ENDPOINT}/${imageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_id: productId
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete image');
                }
                
                // Mark image for deletion if editing existing product
                if (document.getElementById('product-id').value) {
                    deletedImageIds.push(imageId);
                    existingImages = existingImages.filter(img => img.image_id != imageId);
                    renderExistingImages(existingImages);
                }
            } catch (error) {
                console.error('Error deleting image:', error);
                alert('Error deleting image. Please try again.');
            }
        }
        
        // Upload product images
        async function uploadProductImages(productId) {
            if (selectedProductImages.length === 0) {
                return;
            }
            
            const formData = new FormData();
            
            // Add each image with metadata
            selectedProductImages.forEach((img, index) => {
                formData.append('images', img.file);
                formData.append('is_primary', img.isPrimary ? '1' : '0');
                formData.append('display_order', index.toString());
            });
            
            // Show uploading status
            const uploadingSpinner = document.createElement('div');
            uploadingSpinner.className = 'uploading-spinner active';
            uploadingSpinner.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading images...';
            imageUploadContainer.appendChild(uploadingSpinner);
            
            try {
                const response = await fetch(`${PRODUCT_IMAGES_ENDPOINT}/${productId}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Image upload failed:', error);
                throw error;
            } finally {
                uploadingSpinner.remove();
            }
        }
        
        // Delete multiple images in batch
        async function deleteImagesBatch(productId, imageIds) {
            if (imageIds.length === 0) {
                return;
            }
            
            try {
                const response = await fetch(`${PRODUCT_IMAGES_ENDPOINT}/batch-delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        image_ids: imageIds
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete images');
                }
            } catch (error) {
                console.error('Error deleting images:', error);
                throw error;
            }
        }
        
        // Validate product form
        function validateProductForm() {
            const requiredFields = [
                { id: 'product-name', errorId: 'name-error', message: 'Product name is required' },
                { id: 'product-sku', errorId: 'sku-error', message: 'SKU is required' },
                { id: 'product-category', errorId: 'category-error', message: 'Category is required' },
                { id: 'product-price', errorId: 'price-error', message: 'Price is required' },
                { id: 'stock-quantity', errorId: 'stock-error', message: 'Stock quantity is required' },
                { id: 'short-description', errorId: 'short-desc-error', message: 'Short description is required' }
            ];
            
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
            document.querySelectorAll('.field-error').forEach(el => {
                el.classList.remove('field-error');
            });
            
            // Validate each required field
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                const errorElement = document.getElementById(field.errorId);
                
                if (!element.value.trim()) {
                    element.classList.add('field-error');
                    errorElement.textContent = field.message;
                    isValid = false;
                    
                    // Scroll to first error
                    if (isValid === false) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        element.focus();
                    }
                }
            });
            
            return isValid;
        }
        
        // Get product form data
        function getProductFormData() {
            return {
                sku: document.getElementById('product-sku').value,
                name: document.getElementById('product-name').value,
                subtitle: document.getElementById('product-subtitle').value,
                description: document.getElementById('product-description').value,
                short_description: document.getElementById('short-description').value,
                category_id: document.getElementById('product-category').value,
                subcategory_id: document.getElementById('product-subcategory').value || null,
                price: parseFloat(document.getElementById('product-price').value),
                original_price: document.getElementById('original-price').value ? 
                    parseFloat(document.getElementById('original-price').value) : null,
                cost: document.getElementById('product-cost').value ? 
                    parseFloat(document.getElementById('product-cost').value) : null,
                is_featured: document.getElementById('is-featured').checked ? 1 : 0,
                is_bestseller: document.getElementById('is-bestseller').checked ? 1 : 0,
                is_new: document.getElementById('is-new').checked ? 1 : 0,
                stock_quantity: parseInt(document.getElementById('stock-quantity').value),
                low_stock_threshold: parseInt(document.getElementById('low-stock-threshold').value),
                weight_kg: document.getElementById('weight-kg').value ? 
                    parseFloat(document.getElementById('weight-kg').value) : null,
                dimensions: document.getElementById('dimensions').value || null,
                warranty_period: document.getElementById('warranty-period').value || null,
                is_customizable: document.getElementById('is-customizable').checked ? 1 : 0,
                is_active: document.getElementById('is-active').checked ? 1 : 0,
                meta_title: document.getElementById('meta-title').value || null,
                meta_description: document.getElementById('meta-description').value || null,
                slug: document.getElementById('product-slug').value || null
            };
        }
        
        // Load product data for editing
        async function loadProductForEditing(productId) {
            try {
                showLoading();
                const response = await fetch(`${PRODUCTS_ENDPOINT}/${productId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch product');
                }
                const product = await response.json();
                
                // Populate form
                modalTitle.textContent = 'Edit Product';
                document.getElementById('product-id').value = product.product_id;
                document.getElementById('product-sku').value = product.sku;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-subtitle').value = product.subtitle || '';
                document.getElementById('product-description').value = product.description || '';
                document.getElementById('short-description').value = product.short_description || '';
                document.getElementById('product-category').value = product.category_id;
                document.getElementById('product-subcategory').value = product.subcategory_id || '';
                document.getElementById('product-price').value = product.price;
                document.getElementById('original-price').value = product.original_price || '';
                document.getElementById('product-cost').value = product.cost || '';
                document.getElementById('is-featured').checked = product.is_featured === 1;
                document.getElementById('is-bestseller').checked = product.is_bestseller === 1;
                document.getElementById('is-new').checked = product.is_new === 1;
                document.getElementById('stock-quantity').value = product.stock_quantity;
                document.getElementById('low-stock-threshold').value = product.low_stock_threshold;
                document.getElementById('weight-kg').value = product.weight_kg || '';
                document.getElementById('dimensions').value = product.dimensions || '';
                document.getElementById('warranty-period').value = product.warranty_period || '';
                document.getElementById('is-customizable').checked = product.is_customizable === 1;
                document.getElementById('is-active').checked = product.is_active === 1;
                document.getElementById('meta-title').value = product.meta_title || '';
                document.getElementById('meta-description').value = product.meta_description || '';
                document.getElementById('product-slug').value = product.slug || '';
                
                // Show existing images
                renderExistingImages(product.images || []);
                
                // Reset new image uploads
                imagePreviewContainer.style.display = 'none';
                imagePreviewGrid.innerHTML = '';
                selectedProductImages = [];
                deletedImageIds = [];
                
                productModal.style.display = 'flex';
                hideLoading();
            } catch (error) {
                console.error('Error loading product for editing:', error);
                hideLoading();
                alert('Error loading product. Please try again.');
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Add product button
            addProductBtn.addEventListener('click', () => {
                modalTitle.textContent = 'Add New Product';
                productForm.reset();
                document.getElementById('product-id').value = '';
                imagePreviewContainer.style.display = 'none';
                imagePreviewGrid.innerHTML = '';
                existingImagesGrid.innerHTML = '<p>No images uploaded yet.</p>';
                selectedProductImages = [];
                deletedImageIds = [];
                productModal.style.display = 'flex';
            });
            
            // Close modals
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            cancelProductBtn.addEventListener('click', () => {
                productModal.style.display = 'none';
            });
            
            cancelBulkEditBtn.addEventListener('click', () => {
                bulkEditModal.style.display = 'none';
            });
            
            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-btn').forEach(tb => tb.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update active tab content
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Form submission
            productForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const productId = document.getElementById('product-id').value;
                const isEdit = !!productId;
                
                try {
                    // Validate form
                    if (!validateProductForm()) {
                        return;
                    }
                    
                    // Show loading state
                    const submitBtn = productForm.querySelector('button[type="submit"]');
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                    
                    // 1. Save product data first
                    const productData = getProductFormData();
                    let productResponse;
                    
                    if (isEdit) {
                        productResponse = await fetch(`${PRODUCTS_ENDPOINT}/${productId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(productData)
                        });
                    } else {
                        productResponse = await fetch(PRODUCTS_ENDPOINT, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(productData)
                        });
                    }
                    
                    if (!productResponse.ok) {
                        throw new Error('Failed to save product data');
                    }
                    
                    const productResult = await productResponse.json();
                    const savedProductId = productResult.product_id || productId;
                    
                    // 2. Handle image uploads if any
                    if (selectedProductImages.length > 0) {
                        try {
                            await uploadProductImages(savedProductId);
                        } catch (uploadError) {
                            console.error('Image upload failed:', uploadError);
                            // Continue even if image upload fails - product is already saved
                            alert('Product saved but some images failed to upload');
                        }
                    }
                    
                    // 3. Handle deleted images if editing
                    if (isEdit && deletedImageIds.length > 0) {
                        try {
                            await deleteImagesBatch(savedProductId, deletedImageIds);
                        } catch (deleteError) {
                            console.error('Image deletion failed:', deleteError);
                            // Non-critical error
                        }
                    }
                    
                    // Success
                    alert(`Product ${isEdit ? 'updated' : 'created'} successfully!`);
                    productModal.style.display = 'none';
                    loadProducts();
                    
                } catch (error) {
                    console.error('Operation failed:', error);
                    alert(`Error: ${error.message}`);
                } finally {
                    // Reset button state
                    const submitBtn = productForm.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Save Product';
                    }
                }
            });
            
            // Edit product buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.action-btn.edit')) {
                    const productId = e.target.closest('[data-product-id]').getAttribute('data-product-id');
                    loadProductForEditing(productId);
                }
                
                if (e.target.closest('.action-btn.inventory')) {
                    const productId = e.target.closest('[data-product-id]').getAttribute('data-product-id');
                    alert(`Managing inventory for product ID: ${productId}`);
                }
            });
            
            // Bulk edit button
            bulkEditBtn.addEventListener('click', function() {
                const selectedProducts = Array.from(document.querySelectorAll('.product-checkbox:checked'));
                
                if (selectedProducts.length === 0) {
                    alert('Please select at least one product to edit');
                    return;
                }
                
                bulkEditModal.style.display = 'flex';
            });
            
            // Bulk edit field selection
            document.getElementById('bulk-edit-field').addEventListener('change', function() {
                const field = this.value;
                const container = document.getElementById('bulk-edit-value-container');
                const inputContainer = document.getElementById('bulk-edit-value-input');
                const label = document.getElementById('bulk-edit-value-label');
                
                if (!field) {
                    container.style.display = 'none';
                    return;
                }
                
                container.style.display = 'block';
                inputContainer.innerHTML = '';
                
                switch(field) {
                    case 'price':
                    case 'cost':
                    case 'stock':
                        label.textContent = 'New Value';
                        inputContainer.innerHTML = `
                            <input type="number" class="form-control" step="0.01" min="0" required>
                        `;
                        break;
                    case 'category':
                        label.textContent = 'New Category';
                        const select1 = document.createElement('select');
                        select1.className = 'form-control';
                        select1.innerHTML = '<option value="">Select Category</option>';
                        categories.forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.category_id;
                            option.textContent = category.name;
                            select1.appendChild(option);
                        });
                        inputContainer.appendChild(select1);
                        break;
                    case 'subcategory':
                        label.textContent = 'New Subcategory';
                        const select2 = document.createElement('select');
                        select2.className = 'form-control';
                        select2.innerHTML = '<option value="">Select Subcategory</option>';
                        subcategories.forEach(subcategory => {
                            const option = document.createElement('option');
                            option.value = subcategory.subcategory_id;
                            option.textContent = subcategory.name;
                            select2.appendChild(option);
                        });
                        inputContainer.appendChild(select2);
                        break;
                    case 'status':
                        label.textContent = 'New Status';
                        inputContainer.innerHTML = `
                            <select class="form-control">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        `;
                        break;
                }
            });
            
            // Select all checkbox
            selectAllCheckbox.addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.product-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
        }
        
        // Show loading spinner
        function showLoading() {
            loadingSpinner.style.display = 'block';
        }
        
        // Hide loading spinner
        function hideLoading() {
            loadingSpinner.style.display = 'none';
        }
    </script>
</body>
</html>